<!DOCTYPE html>
<html lang="en">

<!-- head公共模块开始 -->
{{template "common/head.html" .}}
<!-- hea公共模块结束 -->

<body>

<!--====== Sign In Content  ======-->
<section class="sign-in-section p-t-120 p-b-120">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-xl-5 col-lg-6 col-md-8 col-sm-10">
                <div class="sign-in-up-wrapper">
                    <form>
                        <div class="form-groups">
                            <h4 class="form-title">Create Your Account</h4>
                            <div class="field-group">
                                <div class="icon">
                                    <i class="far fa-user"></i>
                                </div>
                                <input id="username" type="text" placeholder="Username">
                            </div>
                            <div class="field-group login-email-box">
                                <div class="icon">
                                    <i class="far fa-envelope"></i>
                                </div>
                                <input id="email" type="email" placeholder="Email Address">
                                <button class="send-code-button">Send Code</button>
                            </div>
                            <div class="field-group">
                                <div class="icon">
                                    <i class="far fa-rss"></i>
                                </div>
                                <input id="code" type="text" placeholder="Email verification code">
                            </div>
                            <div class="field-group">
                                <div class="icon">
                                    <i class="far fa-lock"></i>
                                </div>
                                <input id="password" type="password" placeholder="Password">
                            </div>
                            <div class="field-group">
                                <div class="icon">
                                    <i class="far fa-lock"></i>
                                </div>
                                <input id="confirmPassword" type="password" placeholder="Confirm Password">
                            </div>
                            <div class="field-group">
                                <button id="register" type="submit">Create Account</button>
                            </div>
                        </div>
                        <div class="form-note">
                            <p>Already have an account? <a href="/sign-in">Log In</a></p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
<!--====== Sign In End ======-->
<!--脚本文件-->
{{template "common/script.html" .}}
<script>
    $(function () {
        $(".send-code-button").click(function () {
            var loading = false
            const emailRegExp = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z]{2,4})+$/;
            var email = $("input[type='email']").val()
            if (!emailRegExp.test(email)) {
                $.toast("The mailbox format is incorrect")
                return false
            }
            if (loading) {
                return false
            }
            loading = true
            $.ajax({
                url: "/api/v1/send-code",
                type: "POST",
                data: JSON.stringify({email: email}),
                dateType: "json",
                error: function (error) {
                    $.toast(error.responseJSON.message || "The verification code has been sent fail")
                },
                success: function () {
                    $.toast("The verification code has been sent")
                },
                complete: function () {
                    loading = false
                }
            })
            return false
        })
        $("#register").click(function () {
            var username = $("#username").val()
            var email = $("input[type='email']").val()
            var code = $("#code").val()
            var password = $("#password").val()
            var confirmPassword = $("#confirmPassword").val()
            if (!username) {
                $.toast("The user name cannot be empty")
                return false
            }
            if (!email) {
                $.toast("The email cannot be empty")
                return false
            }
            if (!code) {
                $.toast("The code cannot be empty")
                return false
            }
            if (!password) {
                $.toast("The password cannot be empty")
                return false
            }
            if (password !== confirmPassword) {
                $.toast("The password and confirm password are not the same")
                return false
            }
            var loading = false
            if (loading) {
                return false
            }
            loading = true
            $.ajax({
                url: "/api/v1/register",
                type: "POST",
                data: JSON.stringify({name: username, email: email, code: code, password: password}),
                dateType: "json",
                success: function () {
                    $.toast("The verification code has been sent")
                },
                error: function (error) {
                    $.toast(error.responseJSON.message || "The verification code has been sent fail")

                },
                complete: function () {
                    loading = false
                }
            })
            return false
        })
    })
</script>
<!--脚本文件-->
</body>

</html>